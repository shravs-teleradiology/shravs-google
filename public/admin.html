<!DOCTYPE html>
<html lang="en">
<head>
    <!-- YOUR EXISTING HEAD - NO CHANGE -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Shravs</title>
    <!-- YOUR EXISTING STYLES - NO CHANGE -->
    <style>
        /* YOUR ENTIRE EXISTING CSS - KEEP AS IS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        /* ... all your existing styles ... */
    </style>
</head>
<body>
    <!-- YOUR EXISTING HEADER - NO CHANGE -->
    <div class="header">
        <div class="header-left">
            <a href="index.html"><img src="logo.jpg" alt="Shravs Logo" class="logo"></a>
            <div class="header-title">Admin Dashboard</div>
        </div>
        <button onclick="logout()">Logout</button>
    </div>

    <div class="container">
        <!-- 1. YOUR EXISTING CREATE EMPLOYEE - NO CHANGE -->
        <div class="card">
            <h2>üë§ Create New Employee</h2>
            <!-- YOUR EXISTING FORM - NO CHANGE -->
        </div>

        <!-- 2. YOUR EXISTING ASSIGN TASK - NO CHANGE -->
        <div class="card">
            <h2>üìù Assign Task to Employee</h2>
            <!-- YOUR EXISTING FORM - NO CHANGE -->
        </div>

        <!-- 3. YOUR EXISTING PENDING DOCTORS - UPDATE TO PENDING DIAGNOSTICS -->
        <div class="card">
            <h2>ü©∫ Pending Diagnostics Approvals</h2>
            <div id="pendingDiagnostics">
                <div class="empty-state">Loading...</div>
            </div>
        </div>

        <!-- 4. YOUR EXISTING PROMOTE EMPLOYEE - NO CHANGE -->
        <div class="card">
            <h2>‚¨ÜÔ∏è Promote Employee to Admin</h2>
            <!-- YOUR EXISTING FORM - NO CHANGE -->
        </div>

        <!-- 5. YOUR EXISTING ALL EMPLOYEES - NO CHANGE -->
        <div class="card">
            <h2>üë• All Employees</h2>
            <!-- YOUR EXISTING TABLE - NO CHANGE -->
        </div>

        <!-- 6. YOUR EXISTING ALL QUERIES - NO CHANGE -->
        <div class="card full-width">
            <h2>üìß All User Queries</h2>
            <!-- YOUR EXISTING TABLE - NO CHANGE -->
        </div>

        <!-- üî• NEW 7. PENDING DIAGNOSTICS SECTION -->
        <div class="card">
            <h2>üî¨ Pending Diagnostics</h2>
            <div class="success-msg" id="pendingDiagnosticsSuccess">Diagnostics loaded successfully!</div>
            <div id="pendingDiagnosticsList">
                <div class="empty-state">Loading...</div>
            </div>
        </div>

        <!-- üî• NEW 8. APPROVE DOCTOR SECTION -->
        <div class="card">
            <h2>‚úÖ Approve Doctor</h2>
            <div class="success-msg" id="approveDoctorSuccess">Doctor approved successfully!</div>
            <div id="pendingDoctorsList">
                <div class="empty-state">Loading...</div>
            </div>
        </div>
    </div>
    <!-- üî• NEW 1: Pending Diagnostics -->
<div class="card">
    <h2>üî¨ Pending Diagnostics</h2>
    <div class="success-msg" id="pendingDiagnosticsSuccess">Diagnostics loaded successfully!</div>
    <div id="pendingDiagnosticsList">
        <div class="empty-state">Loading...</div>
    </div>
</div>

<!-- üî• NEW 2: Approve Doctors -->
<div class="card">
    <h2>üë®‚Äç‚öïÔ∏è Approve Doctors</h2>
    <div class="success-msg" id="approveDoctorSuccess">Doctor approved successfully!</div>
    <div id="pendingDoctorsList">
        <div class="empty-state">Loading...</div>
    </div>
</div>

    <!-- üî• UPDATED SCRIPT WITH 2 NEW FUNCTIONS -->
    <script type="module">
        // YOUR EXISTING IMPORTS
        import { adminPendingDoctors, adminApproveDoctor, logout as apiLogout } from './api.js';

        // YOUR ALL EXISTING FORM HANDLERS - NO CHANGE
        // ... keep all your existing createEmployeeForm, assignTaskForm, etc.

        // üî• NEW: LOAD PENDING DIAGNOSTICS
        async function loadPendingDiagnostics() {
            try {
                const res = await fetch('/api/admin-pending-diagnostics', {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                const diagnostics = await res.json();
                
                const container = document.getElementById('pendingDiagnosticsList');
                if (!diagnostics.length) {
                    container.innerHTML = '<div class="empty-state">No pending diagnostics.</div>';
                    return;
                }

                let html = '<table><tr><th>Name</th><th>Email</th><th>Speciality</th><th>Action</th></tr>';
                diagnostics.forEach(d => {
                    html += `<tr>
                        <td>${d.name}</td>
                        <td>${d.email}</td>
                        <td>${d.speciality || 'N/A'}</td>
                        <td><button onclick="approveDiagnostic('${d.id}')">‚úì Approve</button></td>
                    </tr>`;
                });
                html += '</table>';
                container.innerHTML = html;
            } catch (e) {
                document.getElementById('pendingDiagnosticsList').innerHTML = '<div class="empty-state">Error loading diagnostics</div>';
            }
        }

        // üî• NEW: APPROVE DOCTOR FUNCTION
        window.approveDoctor = async (id) => {
            if (!confirm('Approve this doctor?')) return;
            try {
                const res = await fetch('/api/admin-approve-doctor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ id })
                });
                
                if (!res.ok) throw new Error('Approval failed');
                alert('Doctor approved successfully!');
                loadPendingDoctors(); // Refresh list
            } catch (e) {
                alert('Approval failed: ' + e.message);
            }
        };

        // YOUR EXISTING FUNCTIONS - NO CHANGE
        // loadEmployees(), loadPendingDoctors(), promoteToAdmin(), etc.

        // üî• INIT - ADD NEW LOADERS
        loadEmployees();
        loadPendingDiagnostics();  // üî• NEW
        loadPendingDoctors();
        loadQueries();
        
        setInterval(() => {
            loadPendingDiagnostics();  // üî• NEW
            loadPendingDoctors();
            loadQueries();
        }, 30000);
    </script>
</body>
</html>
